<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
       

        .dashboard-title {
            font-size: 2em;
            font-weight: bold;
            letter-spacing: 1px;
            margin-bottom: 0.4em;
        }

        .card {
            margin-bottom: 2em;
        }

    </style>
</head>

<body>
    <!-- Minimal Bootstrap Sidebar -->

    <div class="container-fluid ">
        <div class="row ">
            <div class="d-flex flex-column flex-shrink-0 bg-light border-end  start-0 col-sm-1 vh-100 sticky-top" >
        <a href="/" class="d-block p-2 py-3 text-center border-bottom">
            <img src="MEDIA/FINBUDDY(1).png" alt="App Logo" class="img-fluid icon-animate" style="max-height: 40px;">
        </a>

        <ul class="nav nav-pills flex-column mb-auto text-center" style="font-size: 1.1rem;">
            
            <li class="nav-item my-2 border-bottom">
            <a href="dashboard.html" class="py-2  nav-link icon-animate position-relative active"
                data-bs-toggle="tooltip" data-bs-placement="right" title="Dashboard" aria-current="page"
                style="padding-left: 0; padding-right: 0; font-size: 0.95rem;">
                <div class="d-flex justify-content-center align-items-center" style="height: 32px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-grid nav-icon" viewBox="0 0 16 16">
                    <path
                    d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z" />
                </svg>
                </div>
            </a>
            </li>

            <li class="nav-item my-2">
            <a href="expense.html" class="py-2 border-bottom nav-link icon-animate"
                data-bs-toggle="tooltip" data-bs-placement="right" title="Expense Tracker"
                style="padding-left: 0; padding-right: 0;">
                <div class="d-flex justify-content-center align-items-center" style="height: 32px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--bs-dark-border-subtle)"
                    class="bi bi-cash-stack nav-icon" viewBox="0 0 16 16">
                    <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4" />
                    <path
                    d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2z" />
                </svg>
                </div>
            </a>
            </li>
            <li>
            <a href="saving.html" class="nav-link py-2 my-2 border-bottom icon-animate"
                data-bs-toggle="tooltip" data-bs-placement="right" title="Savings Goals"
                style="padding-left: 0; padding-right: 0;">
                <div class="d-flex justify-content-center align-items-center" style="height: 32px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--bs-dark-border-subtle)"
                    class="bi bi-bullseye nav-icon" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                    <path d="M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10m0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12" />
                    <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8" />
                    <path d="M9.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                </svg>
                </div>
            </a>
            </li>
            <li>
            <a href="bankDisplay.html" class="nav-link py-2 border-bottom icon-animate"
                data-bs-toggle="tooltip" data-bs-placement="right" title="Account Balance"
                style="padding-left: 0; padding-right: 0;">
                <div class="d-flex justify-content-center align-items-center" style="height: 32px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--bs-dark-border-subtle)"
                    class="bi bi-wallet2 nav-icon" viewBox="0 0 16 16">
                    <path
                    d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.432-1.499zM5.562 3H13V1.78a.5.5 0 0 0-.621-.484zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5z" />
                </svg>
                </div>
            </a>
            </li>
        </ul>
        <div class="dropend border-top mt-auto">
            <a href="#"
            class="d-flex align-items-center justify-content-center p-2 link-body-emphasis text-decoration-none dropdown-toggle"
            data-bs-toggle="dropdown" aria-expanded="false">
            <img src="https://github.com/mdo.png" alt="mdo"
                width="20" height="20" class="rounded-circle">
            </a>
            <ul class="dropdown-menu text-small shadow">
            <li><a class="dropdown-item" href="editProfile.html">Edit Profile</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="login.html">Log Out</a></li>
            </ul>
        </div>
        <!-- End Sidebar -->
    </div>


    <!-- Main Content -->
    <div class="container py-5 col-10">
        <div class="text-start mb-4">
            <div class="dashboard-title">DASHBOARD</div>
            <div>Welcome, <span id="username">User</span>!</div>
            <div id="datetime"></div>
           
        </div>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header"><b>Budget for This Month</b></div>
                    <div class="card-body" id="budgetSection">
                        <!-- Budget form or info will be injected by JS -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center g-4">
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header"><b>Monthly Expense Breakdown</b></div>
                    <div class="card-body">
                        <canvas id="expensePie" width="300" height="300"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header"><b>Saving Goal Progress</b></div>
                    <div class="card-body text-center">
                        <div id="goalTitle" class="fw-bold mb-2"></div>
                        <canvas id="savingPie" width="250" height="250"></canvas>
                        <div class="mt-3">
                            <button id="prevGoal" class="btn btn-outline-primary me-2">&#8592; Prev</button>
                            <button id="nextGoal" class="btn btn-outline-primary">Next &#8594;</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-5">
            <a href="expense.html" class="btn btn-success me-2">Expense Tracker</a>
            <a href="saving.html" class="btn btn-warning">Saving Goal</a>
        </div>
    </div>
    </div>
    </div>
    <script>
        // Dummy data for demonstration
        const username = "User";
        const budget_amount = 2000;
        const total_expense = 1200;
        const average_expense = 40;
        const edit_mode = false;
        const expense_types = ["Food", "Transport", "Bills"];
        const expense_totals = [600, 300, 300];
        const saving_goals = [
            { name: "Vacation", current: 500, target: 1000 },
            { name: "Emergency Fund", current: 300, target: 2000 }
        ];

        document.getElementById('username').innerText = username;

        // Budget Section
        function renderBudgetSection() {
            const section = document.getElementById('budgetSection');
            section.innerHTML = '';
            if (budget_amount === 0 || edit_mode) {
                section.innerHTML = `
                    <form id="budgetForm">
                        <div class="mb-3">
                            <label class="form-label">Enter your budget for this month (RM):</label>
                            <input type="number" class="form-control" name="budget_amount" min="1" required value="${budget_amount > 0 ? budget_amount : ''}">
                        </div>
                        <button type="submit" class="btn btn-primary">${budget_amount > 0 ? 'Update' : 'Save'}</button>
                        ${budget_amount > 0 ? '<button type="button" class="btn btn-secondary ms-2" id="cancelEdit">Cancel</button>' : ''}
                    </form>
                `;
                if (budget_amount > 0) {
                    document.getElementById('cancelEdit').onclick = () => location.reload();
                }
                document.getElementById('budgetForm').onsubmit = function (e) {
                    e.preventDefault();
                    alert('Budget saved! (Demo)');
                    location.reload();
                };
            } else {
                section.innerHTML = `
                    <p>Monthly Budget: <b>RM${budget_amount.toFixed(2)}</b></p>
                    <p>Total Spent: RM${total_expense.toFixed(2)}</p>
                    <p>Daily Average: RM${average_expense.toFixed(2)}</p>
                    ${total_expense > budget_amount
                        ? '<p class="text-danger fw-bold">Budget Exceeded!</p>'
                        : `<p>You can still spend RM${(budget_amount - total_expense).toFixed(2)} before reaching your limit.</p>`
                    }
                    <button type="button" class="btn btn-outline-primary" id="editBudgetBtn">Edit Budget</button>
                `;
                document.getElementById('editBudgetBtn').onclick = () => location.reload();
            }
        }
        renderBudgetSection();

        // Expense Pie Chart
        new Chart(document.getElementById('expensePie'), {
            type: 'pie',
            data: {
                labels: expense_types,
                datasets: [{
                    data: expense_totals,
                    backgroundColor: [
                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796', '#5a5c69'
                    ]
                }]
            }
        });

        // Saving Goal Pie Chart
        let currentGoalIdx = 0;
        const ctx = document.getElementById('savingPie').getContext('2d');
        let savingPieChart;

        function updateSavingPie(idx) {
            if (saving_goals.length === 0) {
                document.getElementById('goalTitle').innerText = "No Saving Goals";
                ctx.clearRect(0, 0, 250, 250);
                return;
            }
            const goal = saving_goals[idx];
            const saved = parseFloat(goal.current);
            const remain = Math.max(0, parseFloat(goal.target) - saved);
            document.getElementById('goalTitle').innerText = `${goal.name}: RM${saved} / RM${goal.target}`;
            const data = {
                labels: ['Saved', 'Not Yet Saved'],
                datasets: [{
                    data: [saved, remain],
                    backgroundColor: ['#1cc88a', '#e74a3b']
                }]
            };
            if (savingPieChart) {
                savingPieChart.data = data;
                savingPieChart.update();
            } else {
                savingPieChart = new Chart(ctx, {
                    type: 'pie',
                    data: data,
                    options: {
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return context.label + ': RM' + context.parsed;
                                    }
                                }
                            },
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        updateSavingPie(currentGoalIdx);

        document.getElementById('prevGoal').onclick = function () {
            if (saving_goals.length === 0) return;
            currentGoalIdx = (currentGoalIdx - 1 + saving_goals.length) % saving_goals.length;
            updateSavingPie(currentGoalIdx);
        };
        document.getElementById('nextGoal').onclick = function () {
            if (saving_goals.length === 0) return;
            currentGoalIdx = (currentGoalIdx + 1) % saving_goals.length;
            updateSavingPie(currentGoalIdx);
        };

        // Dummy datetime
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Enable Bootstrap tooltips
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>

</html>

</html>