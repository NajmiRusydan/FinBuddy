<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #f8f9fa;
        }

        .dashboard-title {
            font-size: 2em;
            font-weight: bold;
            letter-spacing: 1px;
            margin-bottom: 0.4em;
        }

        .card {
            margin-bottom: 2em;
        }
    </style>
</head>

<body>
    <!-- Minimal Bootstrap Sidebar -->
    <div class="d-flex flex-column flex-shrink-0 bg-light border-end position-fixed"
        style="width: 4.5rem; height: 100vh; z-index: 100;">
        <a href="/" class="d-block p-3 text-center border-bottom">
            <img src="MEDIA/FINBUDDY(1).png" alt="App Logo" class="img-fluid" style="max-height: 40px;">
        </a>
        <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
            <li class="nav-item">
                <a href="expense.html" class="py-3 border-bottom fs-3 nav-link icon-animate" title="Expense" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cash-stack expense-icon" viewBox="0 0 16 16">
                        <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                        <path d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2z"/>
                    </svg>
                </a>
            </li>
            <style>
                .icon-animate .expense-icon {
                    transition: transform 0.3s cubic-bezier(.68,-0.55,.27,1.55);
                }
                .icon-animate:hover .expense-icon {
                    transform: scale(1.2) ;
                }
            </style>
            <li>
                <a href="saving.html" class="nav-link py-3 border-bottom" title="Savings Goal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-piggy-bank" viewBox="0 0 16 16"></svg>
                        <path d="M5.5 5a.5.5 0 0 1 .5-.5h.5V4a2 2 0 1 1 4 0v.5h.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5H6a.5.5 0 0 1-.5-.5V5zm1-1a1 1 0 0 0-1 1v.5h4V5a1 1 0 0 0-1-1h-2z"/>
                        <path d="M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8zm6-5a5 5 0 1 0 0 10A5 5 0 0 0 8 3z"/>
                    </svg>
                </a>
            </li>
            <li>
                <a href="bankDisplay.html" class="nav-link py-3 border-bottom" title="Balance">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-wallet2" viewBox="0 0 16 16">
  <path d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.432-1.499zM5.562 3H13V1.78a.5.5 0 0 0-.621-.484zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5z"/>
</svg>
                </a>
            </li>
            <li></svg>
                <a href="bankDisplay.html" class="nav-link py-3 border-bottom" title="Balance">
                    <i class="bi bi-wallet2"></i>
                </a>
            </li>
            
        </ul>
        <div class="dropend border-top"> <a href="#" class="d-flex align-items-center justify-content-center p-3 link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"> <img src="https://github.com/mdo.png" alt="mdo" width="24" height="24" class="rounded-circle"> </a>
            <ul class="dropdown-menu text-small shadow">
                <li><a class="dropdown-item" href="#">Edit Profile</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Log Out</a></li>
            </ul>
        </div>
        <!-- End Sidebar -->
    </div>

    <div class="container py-5">
        <div class="text-center mb-4">
            <div class="dashboard-title">DASHBOARD</div>
            <div>Welcome, <span id="username">User</span>!</div>
            <div id="datetime"></div>
            <div class="mt-3">
                <a href="editProfile.html" class="btn btn-primary me-2">Edit Profile</a>
                <a href="login.html" class="btn btn-secondary me-2">Log Out</a>
                <a href="bankDisplay.html" class="btn btn-info">Bank</a>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header"><b>Budget for This Month</b></div>
                    <div class="card-body" id="budgetSection">
                        <!-- Budget form or info will be injected by JS -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center g-4">
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header"><b>Monthly Expense Breakdown</b></div>
                    <div class="card-body">
                        <canvas id="expensePie" width="300" height="300"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header"><b>Saving Goal Progress</b></div>
                    <div class="card-body text-center">
                        <div id="goalTitle" class="fw-bold mb-2"></div>
                        <canvas id="savingPie" width="250" height="250"></canvas>
                        <div class="mt-3">
                            <button id="prevGoal" class="btn btn-outline-primary me-2">&#8592; Prev</button>
                            <button id="nextGoal" class="btn btn-outline-primary">Next &#8594;</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-5">
            <a href="expense.html" class="btn btn-success me-2">Expense Tracker</a>
            <a href="saving.html" class="btn btn-warning">Saving Goal</a>
        </div>
    </div>

    <script>
        // Dummy data for demonstration
        const username = "User";
        const budget_amount = 2000;
        const total_expense = 1200;
        const average_expense = 40;
        const edit_mode = false;
        const expense_types = ["Food", "Transport", "Bills"];
        const expense_totals = [600, 300, 300];
        const saving_goals = [
            { name: "Vacation", current: 500, target: 1000 },
            { name: "Emergency Fund", current: 300, target: 2000 }
        ];

        document.getElementById('username').innerText = username;

        // Budget Section
        function renderBudgetSection() {
            const section = document.getElementById('budgetSection');
            section.innerHTML = '';
            if (budget_amount === 0 || edit_mode) {
                section.innerHTML = `
                    <form id="budgetForm">
                        <div class="mb-3">
                            <label class="form-label">Enter your budget for this month (RM):</label>
                            <input type="number" class="form-control" name="budget_amount" min="1" required value="${budget_amount > 0 ? budget_amount : ''}">
                        </div>
                        <button type="submit" class="btn btn-primary">${budget_amount > 0 ? 'Update' : 'Save'}</button>
                        ${budget_amount > 0 ? '<button type="button" class="btn btn-secondary ms-2" id="cancelEdit">Cancel</button>' : ''}
                    </form>
                `;
                if (budget_amount > 0) {
                    document.getElementById('cancelEdit').onclick = () => location.reload();
                }
                document.getElementById('budgetForm').onsubmit = function (e) {
                    e.preventDefault();
                    alert('Budget saved! (Demo)');
                    location.reload();
                };
            } else {
                section.innerHTML = `
                    <p>Your budget for this month is: <b>RM${budget_amount.toFixed(2)}</b></p>
                    <p>Total expense for this month: RM${total_expense.toFixed(2)}</p>
                    <p>Average expense per day: RM${average_expense.toFixed(2)}</p>
                    ${total_expense > budget_amount
                        ? '<p class="text-danger fw-bold">You are over your budget!</p>'
                        : `<p>You have RM${(budget_amount - total_expense).toFixed(2)} left before reaching your budget.</p>`
                    }
                    <button type="button" class="btn btn-outline-primary" id="editBudgetBtn">Edit Budget</button>
                `;
                document.getElementById('editBudgetBtn').onclick = () => location.reload();
            }
        }
        renderBudgetSection();

        // Expense Pie Chart
        new Chart(document.getElementById('expensePie'), {
            type: 'pie',
            data: {
                labels: expense_types,
                datasets: [{
                    data: expense_totals,
                    backgroundColor: [
                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796', '#5a5c69'
                    ]
                }]
            }
        });

        // Saving Goal Pie Chart
        let currentGoalIdx = 0;
        const ctx = document.getElementById('savingPie').getContext('2d');
        let savingPieChart;

        function updateSavingPie(idx) {
            if (saving_goals.length === 0) {
                document.getElementById('goalTitle').innerText = "No Saving Goals";
                ctx.clearRect(0, 0, 250, 250);
                return;
            }
            const goal = saving_goals[idx];
            const saved = parseFloat(goal.current);
            const remain = Math.max(0, parseFloat(goal.target) - saved);
            document.getElementById('goalTitle').innerText = `${goal.name}: RM${saved} / RM${goal.target}`;
            const data = {
                labels: ['Saved', 'Not Yet Saved'],
                datasets: [{
                    data: [saved, remain],
                    backgroundColor: ['#1cc88a', '#e74a3b']
                }]
            };
            if (savingPieChart) {
                savingPieChart.data = data;
                savingPieChart.update();
            } else {
                savingPieChart = new Chart(ctx, {
                    type: 'pie',
                    data: data,
                    options: {
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return context.label + ': RM' + context.parsed;
                                    }
                                }
                            },
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        updateSavingPie(currentGoalIdx);

        document.getElementById('prevGoal').onclick = function () {
            if (saving_goals.length === 0) return;
            currentGoalIdx = (currentGoalIdx - 1 + saving_goals.length) % saving_goals.length;
            updateSavingPie(currentGoalIdx);
        };
        document.getElementById('nextGoal').onclick = function () {
            if (saving_goals.length === 0) return;
            currentGoalIdx = (currentGoalIdx + 1) % saving_goals.length;
            updateSavingPie(currentGoalIdx);
        };

        // Dummy datetime
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
</html>